<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Panel</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
</head>

<body class="p-2">
  <h1>Client Panel</h1>

  <!-- Display inbox -->
  <h3>Inbox</h3>
  <div id="inbox" class="container-fluid"></div> <!-- Inbox container -->

  <script>
    const socket = io('http://localhost:8080');

    // Render email response in the inbox
    function renderEmailResponse(response) {
        if (response) {
            return 
                `<p class="mt-2">
                    <strong>Response:</strong> ${response.status} 
                    <br>
                    <strong>Reason:</strong> ${response.reason}
                    <br>
                    <small class="text-muted">Responded at: ${new Date(response.timestamp).toLocaleString()}</small>
                </p>`;
        }
        return '';
    }

    // Render the inbox
    function addEmailToInbox(email, index) {
        const inbox = document.getElementById('inbox');
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';

        listItem.innerHTML = 
            `<strong>${email.subject}</strong>
            <p>From: Admin</p>
            <small>Sent: ${new Date(email.timestamp).toLocaleString()}</small>
            ${renderEmailResponse(email.response)}
            <button class="btn btn-link btn-sm mt-2" onclick="viewEmail(${index})">View Details</button>`
        ;

        inbox.appendChild(listItem);
    }

    // Navigate to the email details page
    function viewEmail(index) {
        window.location.href = `email.html?index=${index}`;
    }

    // Load inbox with updated emails
    socket.on('load_inbox', (emails) => {
        const inbox = document.getElementById('inbox');
        inbox.innerHTML = ''; // Clear current inbox
        emails.forEach((email, index) => addEmailToInbox(email, index));
    });

    // Request the updated inbox
    socket.emit('request_inbox');
</script>

</body>

</html>

